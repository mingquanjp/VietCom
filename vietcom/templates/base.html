{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}VietCom - Connect Vietnamese{% endblock %}</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <!-- Custom CSS -->
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700;800&display=swap");

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Baloo 2", Arial, sans-serif !important;
      }

      body {
        background: #f5f5f5;
        overflow: hidden;
      }

      /* Map Background */
      .map-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        overflow: hidden;
      }

      .map-lines {
        position: absolute;
        width: 100%;
        height: 100%;
        opacity: 0.3;
      }

      .line {
        position: absolute;
        background: #64b5f6;
        height: 2px;
        border-radius: 1px;
      }

      .line1 {
        top: 20%;
        left: 10%;
        width: 60%;
        transform: rotate(15deg);
      }
      .line2 {
        top: 40%;
        left: 20%;
        width: 70%;
        transform: rotate(-10deg);
      }
      .line3 {
        top: 60%;
        left: 5%;
        width: 80%;
        transform: rotate(25deg);
      }
      .line4 {
        top: 80%;
        right: 10%;
        width: 50%;
        transform: rotate(-20deg);
      }

      /* User Avatars on Map */
      .notification-badge {
        position: absolute;
        bottom: 60px;
        right: 20px;
        background: #c62828;
        color: white;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        box-shadow: 0 4px 12px rgba(198, 40, 40, 0.3);
        cursor: pointer;
        transition: all 0.3s ease;
        border: none;
      }

      .notification-badge:hover {
        background: #a21820;
        transform: scale(1.05);
      }

      /* Sidebar */
      .sidebar {
        position: fixed;
        left: 0;
        top: 0;
        width: 80px;
        height: 100vh;
        background: #c62828;
        display: flex;
        flex-direction: column;
        align-items: center;
        z-index: 1000;
        box-shadow: 4px 0 12px rgba(0, 0, 0, 0.1);
      }

      /* Profile Section */
      .profile-section {
        padding: 20px 0 15px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        margin-bottom: 30px;
      }

      .profile-avatar {
        width: 50px;
        height: 50px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .profile-avatar:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: scale(1.05);
      }

      /* Navigation Buttons Container */
      .nav-buttons {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        gap: 25px;
      }

      .sidebar-btn {
        width: 50px;
        height: 50px;
        background: transparent;
        border: none;
        border-radius: 12px;
        color: white;
        font-size: 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        position: relative;
      }

      .sidebar-btn:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateX(5px);
      }

      .sidebar-btn.active {
        background: rgba(255, 255, 255, 0.3);
        transform: translateX(5px);
      }

      /* Content Panel */
      .content-panel {
        position: fixed;
        left: 80px;
        top: 0;
        width: 400px;
        height: 100vh;
        background: white;
        box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        z-index: 999;
        overflow: hidden;
      }

      .content-panel.active {
        transform: translateX(0);
      }

      .panel-header {
        background: #c62828;
        color: white;
        padding: 20px;
        text-align: center;
        font-weight: 600;
        font-size: 18px;
      }

      .panel-content {
        height: calc(100vh - 70px);
        overflow-y: auto;
        padding: 20px;
      }

      /* Event Cards */
      .event-card {
        background: #fce4ec;
        border-radius: 16px;
        padding: 20px;
        margin-bottom: 16px;
        border: none;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s ease;
      }

      .event-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
      }

      .event-card h3 {
        color: #1565c0;
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 8px;
      }

      .event-card p {
        color: #424242;
        font-size: 14px;
        line-height: 1.5;
        margin-bottom: 12px;
      }

      .see-more-btn {
        background: #1565c0;
        color: white;
        border: none;
        border-radius: 20px;
        padding: 8px 20px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.2s ease;
      }

      .see-more-btn:hover {
        background: #0d47a1;
      }

      /* Custom Scrollbar */
      .panel-content::-webkit-scrollbar {
        width: 6px;
      }

      .panel-content::-webkit-scrollbar-track {
        background: #f5f5f5;
      }

      .panel-content::-webkit-scrollbar-thumb {
        background: #c62828;
        border-radius: 3px;
      }

      /* Hidden checkboxes for state management */
      .panel-toggle {
        display: none;
      }
      /* Panels */
      #mission-toggle:checked ~ .panels .mission-panel,
      #event-toggle:checked ~ .panels .event-panel,
      #achievement-toggle:checked ~ .panels .achievement-panel {
        transform: translateX(0);
      }

      /* Event Panel */
      .event-panel {
        position: fixed;
        left: 80px;
        top: 0;
        width: 400px;
        height: 100vh;
        background: white;
        box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        z-index: 999;
        overflow: hidden;
      }

      /* Achievement Panel */
      .achievement-panel {
        position: fixed;
        left: 80px;
        top: 0;
        width: 400px;
        height: 100vh;
        background: white;
        box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        z-index: 999;
        overflow: hidden;
      }

      #notification-toggle:checked ~ .notification-panel {
        transform: translateX(0);
        opacity: 1;
        pointer-events: auto;
      }

      /* Notification Panel */
      .notification-panel {
        position: fixed;
        right: 20px;
        top: 20px;
        width: 350px;
        max-height: 80vh;
        background: white;
        border-radius: 16px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
        transform: translateX(100%);
        opacity: 0;
        pointer-events: none;
        transition: all 0.3s ease;
        z-index: 1001;
        overflow: hidden;
      }

      .notification-header {
        background: #c62828;
        color: white;
        padding: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .notification-header h3 {
        margin: 0;
        font-size: 18px;
        font-weight: 600;
      }

      .close-notification {
        background: none;
        border: none;
        color: white;
        font-size: 24px;
        cursor: pointer;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: background 0.2s ease;
      }

      .close-notification:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      .notification-content {
        max-height: calc(80vh - 80px);
        overflow-y: auto;
        padding: 10px;
      }

      /* Nearby User Cards */
      .nearby-user {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 15px;
        margin-bottom: 8px;
        background: #f8f9fa;
        border-radius: 12px;
        transition: background 0.2s ease;
      }

      .nearby-user:hover {
        background: #e9ecef;
      }

      .user-info {
        display: flex;
        align-items: center;
        flex: 1;
      }

      .user-pic {
        width: 45px;
        height: 45px;
        background: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        margin-right: 12px;
        border: 2px solid #e9ecef;
      }

      .user-details h4 {
        margin: 0;
        font-size: 16px;
        font-weight: 600;
        color: #333;
      }

      .user-details p {
        margin: 4px 0;
        font-size: 12px;
        color: #666;
      }

      .user-interests {
        font-size: 11px;
        color: #888;
        display: block;
        margin-top: 2px;
      }

      .connect-btn {
        background: #1565c0;
        color: white;
        border: none;
        border-radius: 20px;
        padding: 8px 16px;
        font-size: 12px;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.2s ease;
        flex-shrink: 0;
      }

      .connect-btn:hover {
        background: #0d47a1;
      }

      /* Custom Scrollbar for notification */
      .notification-content::-webkit-scrollbar {
        width: 4px;
      }

      .notification-content::-webkit-scrollbar-track {
        background: #f1f1f1;
      }

      .notification-content::-webkit-scrollbar-thumb {
        background: #c62828;
        border-radius: 2px;
      }

      /* Icon styles */

      .icon-home {
        display: block;
        width: 64px;
        height: 64px;
        background-image: url("/static/images/Home.png");
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
      }
      .icon-message {
        display: block;
        width: 64px;
        height: 64px;
        background-image: url("/static/images/Message.png");
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
      }

      .icon-social {
        display: block;
        width: 64px;
        height: 64px;
        background-image: url("/static/images/Social.png");
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
      }

      .icon-mission {
        display: block;
        width: 64px;
        height: 64px;
        background-image: url("/static/images/MissionButton.png");
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
      }

      .icon-event {
        display: block;
        width: 64px;
        height: 64px;
        background-image: url("/static/images/EventButton.png");
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
      }

      .icon-achievement {
        display: block;
        width: 64px;
        height: 64px;
        background-image: url("/static/images/AchievementButton.png");
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
      }
      /* Profile Dropdown */
      .profile-dropdown {
        position: absolute;
        top: 70px;
        left: 90px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        min-width: 160px;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: all 0.3s ease;
        z-index: 1002;
      }

      .profile-dropdown.show {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      .dropdown-item {
        display: block;
        padding: 12px 16px;
        color: #333;
        text-decoration: none;
        font-size: 14px;
        font-weight: 500;
        transition: background 0.2s ease;
        border-radius: 8px;
        margin: 4px;
      }

      .dropdown-item:hover {
        background: #f5f5f5;
        color: #c62828;
      }

      .dropdown-item:first-child {
        margin-top: 8px;
      }

      .dropdown-item:last-child {
        margin-bottom: 8px;
      }
      .btn-connect {
        background-color: #043a54;
        color: white;
        border: none;
        padding: 8px 20px; /* nhỏ hơn */
        font-size: 16px; /* nhỏ hơn */
        font-weight: bold;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
      }

      .btn-connect:hover {
        background-color: #75a8c5;
        transform: translateY(-2px);
        box-shadow: 0 5px 12px rgba(0, 0, 0, 0.25);
      }

      .btn-connect:active {
        transform: translateY(0);
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      }
    </style>

    {% block extra_css %}{% endblock %}
  </head>
  <body>
    <!-- Hidden checkboxes for panel toggle -->
    <input type="checkbox" id="mission-toggle" class="panel-toggle" />
    <input type="checkbox" id="event-toggle" class="panel-toggle" />
    <input type="checkbox" id="achievement-toggle" class="panel-toggle" />
    <input type="checkbox" id="notification-toggle" class="panel-toggle" />

    <!-- Sidebar -->
    <div class="sidebar">
      <!-- Profile section at top -->
      <div class="profile-section">
        <div class="profile-avatar" id="profile-btn">
          {% if user.avatar %}
          <img
            src="{{ user.avatar.url }}"
            alt="Avatar"
            style="
              width: 100%;
              height: 100%;
              border-radius: 50%;
              object-fit: cover;
            "
          />
          {% else %}
          <i class="fas fa-user"></i>
          {% endif %}
        </div>
        <div class="profile-dropdown" id="profile-dropdown">
          <a
            href="{% url 'profile_update' %}"
            class="dropdown-item"
            id="view-profile"
            >View Profile</a
          >
          <a href="/users/logout/" class="dropdown-item" id="logout">Log Out</a>
        </div>
      </div>

      <!-- Navigation buttons -->
      <div class="nav-buttons">
        <button class="sidebar-btn" id="home-btn" title="Home">
          <span class="icon-home"></span>
        </button>
        <button class="sidebar-btn" id="social-btn" title="Social Network">
          <span class="icon-social"></span>
        </button>
        <button class="sidebar-btn" id="chat-btn" title="Message">
          <span class="icon-message"></span>
          {% if unread_messages_count > 0 %}
          <span
            style="
              position: absolute;
              top: 5px;
              right: 5px;
              background: #fff;
              color: #c62828;
              font-size: 10px;
              border-radius: 50%;
              width: 16px;
              height: 16px;
              display: flex;
              align-items: center;
              justify-content: center;
            "
            >{{ unread_messages_count }}</span
          >
          {% endif %}
        </button>
        <label for="mission-toggle" class="sidebar-btn" title="Mission">
          <span class="icon-mission"></span>
        </label>
        <label for="event-toggle" class="sidebar-btn" title="Event">
          <span class="icon-event"></span>
        </label>
        <label for="achievement-toggle" class="sidebar-btn" title="Achievement">
          <span class="icon-achievement"></span>
        </label>
      </div>
    </div>

    <!-- Content Panels -->
    <div class="panels">
      <!-- Mission Panel -->
      <div class="content-panel mission-panel">
        <div class="panel-header">Mission</div>
        <div class="panel-content">
          <div class="event-card">
            <h3>Daily Check-in</h3>
            <p>
              Start your day by checking in and earning points for consistent
              engagement.
            </p>
            <button
              class="btn-connect"
              onclick="window.location.href='{% url 'gamification:mission_list' %}'"
            >
              See more
            </button>
          </div>
          <div class="event-card">
            <h3>Help a Newcomer</h3>
            <p>Guide someone new to the community and earn mentor badges.</p>
            <button
              class="btn-connect"
              onclick="window.location.href='{% url 'gamification:mission_list' %}'"
            >
              See more
            </button>
          </div>
          <div class="event-card">
            <h3>Share Your Story</h3>
            <p>Tell your journey and inspire others in the community.</p>
            <button
              class="btn-connect"
              onclick="window.location.href='{% url 'gamification:mission_list' %}'"
            >
              See more
            </button>
          </div>
          <div class="event-card">
            <h3>Local Explorer</h3>
            <p>Discover and review local Vietnamese businesses and services.</p>
            <button
              class="btn-connect"
              onclick="window.location.href='{% url 'gamification:mission_list' %}'"
            >
              See more
            </button>
          </div>
        </div>
      </div>

      <!-- Event Panel -->
      <div class="content-panel event-panel">
        <div class="panel-header">Sự kiện</div>
        <div class="panel-content">
          <div class="event-card">
            <h3>🎉 Khám phá sự kiện</h3>
            <p>
              Tham gia các sự kiện thú vị của cộng đồng người Việt: lễ hội ẩm
              thực, giao lưu ngôn ngữ, networking và nhiều hoạt động bổ ích
              khác.
            </p>
            <button
              class="btn-connect"
              onclick="window.location.href='{% url 'events:event_list' %}'"
            >
              Xem tất cả sự kiện
            </button>
          </div>
        </div>
      </div>

      <!-- Achievement Panel -->
      <div class="content-panel achievement-panel">
        <div class="panel-header">Achievements</div>
        <div class="panel-content">
          <div class="event-card">
            <h3>Community Builder</h3>
            <p>
              You've helped 10+ newcomers get started in the community. Keep up
              the great work!
            </p>
            <button
              class="btn-connect"
              onclick="alert('Achievement details coming soon!')"
            >
              View Details
            </button>
          </div>
          <div class="event-card">
            <h3>Social Butterfly</h3>
            <p>
              Connected with 50+ community members. Your network is growing
              strong!
            </p>
            <button
              class="btn-connect"
              onclick="alert('Achievement details coming soon!')"
            >
              View Details
            </button>
          </div>
          <div class="event-card">
            <h3>Culture Ambassador</h3>
            <p>
              Shared 25+ cultural insights and stories. You're spreading
              Vietnamese culture beautifully!
            </p>
            <button
              class="btn-connect"
              onclick="alert('Achievement details coming soon!')"
            >
              View Details
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content Area -->
    <div
      class="main-container"
      style="margin-left: 80px; padding: 20px; min-height: 100vh"
    >
      {% block content %}{% endblock %}
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const toggles = document.querySelectorAll(".panel-toggle");
        const buttons = document.querySelectorAll("label.sidebar-btn");
        const homeBtn = document.getElementById("home-btn");
        const socialBtn = document.getElementById("social-btn");
        const chatBtn = document.getElementById("chat-btn");

        // Home button - navigate to nearby users page
        homeBtn.addEventListener("click", function () {
          window.location.href = '{% url "nearby_users" %}';
        });

        // Social button - navigate to wall page
        socialBtn.addEventListener("click", function () {
          window.location.href = '{% url "wall" %}';
        });

        // Chat button - navigate to chat list
        chatBtn.addEventListener("click", function () {
          window.location.href = '{% url "chat_list" %}';
        });

        // Handle panel toggles for other buttons
        toggles.forEach((toggle, index) => {
          toggle.addEventListener("change", function () {
            if (this.checked) {
              toggles.forEach((otherToggle, otherIndex) => {
                if (otherIndex !== index) {
                  otherToggle.checked = false;
                  if (buttons[otherIndex]) {
                    buttons[otherIndex].classList.remove("active");
                  }
                }
              });
              if (buttons[index]) {
                buttons[index].classList.add("active");
              }
            } else {
              if (buttons[index]) {
                buttons[index].classList.remove("active");
              }
            }
          });
        });

        // Profile dropdown functionality
        const profileBtn = document.getElementById("profile-btn");
        const profileDropdown = document.getElementById("profile-dropdown");

        profileBtn.addEventListener("click", function (e) {
          e.stopPropagation();
          profileDropdown.classList.toggle("show");
        });

        // Close dropdown when clicking outside
        document.addEventListener("click", function (e) {
          if (
            !profileBtn.contains(e.target) &&
            !profileDropdown.contains(e.target)
          ) {
            profileDropdown.classList.remove("show");
          }
        });
      });
    </script>

    {% block extra_js %}{% endblock %}
  </body>
</html>
